<template><div><button v-if="!userAddress" @click="connectWalletAndSwitchNetwork">Connect Wallet </button><div v-else><div>Connected Wallet:{{ userAddress}}</div><input type="text" v-model="noteContent" placeholder="Enter your secret note" /><button @click="submitNote">Submit Note</button><div v-if="txId">Transaction ID: <a :href="`https://sepolia.etherscan.io/tx/${txId}`" target="_blank">{{ txId}}</a></div><div><h2>Transactions</h2><div v-for="tx in transactions" :key="tx.hash"><p>Hash:{{ tx.hash}}</p><p>Block:{{ tx.blockNumber}}</p><p>Value:{{ tx.value}}</p><p>Secret Note:{{ tx.decryptedContent}}</p></div></div></div></div></template><script setup>import{ ref, onMounted} from 'vue';import Web3 from 'web3';import{ nanoid} from 'nanoid';import{ keccak256} from 'js-sha3';import CryptoJS from 'crypto-js';import contractABI from './contractABI.json';const userAddress=ref('');const noteContent=ref('');const txId=ref('');const transactions=ref([]);const contractAddress='0xB285839E49b16487D8D75a76348a7Ff908b39879';let web3, contract;const connectWalletAndSwitchNetwork=async ()=>{ await connectWallet(); await switchToSepolia()};const connectWallet=async ()=>{ if (window.ethereum){ web3=new Web3(window.ethereum); try{ const accounts=await window.ethereum.request({ method: 'eth_requestAccounts',}); userAddress.value=accounts[0];} catch (error){ console.error(error);}} else{ console.error('No wallet detected');}};const switchToSepolia=async ()=>{ try{ await window.ethereum.request({ method: 'wallet_switchEthereumChain', params: [{ chainId: '0x1b'}],});} catch (error){ console.error(error);}};const deriveEncryptionKey=(address)=>{ return keccak256(address)};const decryptNote=(encryptedContent, key)=>{ const bytes=CryptoJS.AES.decrypt(encryptedContent, key); return bytes.toString(CryptoJS.enc.Utf8)};const submitNote=async ()=>{ const key=deriveEncryptionKey(userAddress.value); const encryptedContent=CryptoJS.AES.encrypt( noteContent.value, key ).toString(); const tx=await contract.methods.submitNote(encryptedContent).send({ from: userAddress.value,}); txId.value=tx.transactionHash};const fetchTransactions=async ()=>{ const events=await contract.getPastEvents('NoteSubmitted',{ fromBlock: 0, toBlock: 'latest',}); for (const event of events){ const decryptedContent=decryptNote( event.returnValues.content, deriveEncryptionKey(event.returnValues.sender) ); transactions.value.push({ hash: event.transactionHash, blockNumber: event.blockNumber, value: event.returnValues.content, decryptedContent,});}};onMounted(async ()=>{ web3=new Web3(window.ethereum); contract=new web3.eth.Contract(contractABI, contractAddress); await connectWallet(); await switchToSepolia(); await fetchTransactions()});return{ userAddress, noteContent, txId, transactions, connectWalletAndSwitchNetwork, submitNote,};</script>